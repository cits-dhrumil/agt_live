<?xml version="1.0" encoding="utf-8"?>
<odoo>

        <template id="report_invoice_document_opc" inherit_id="account.report_invoice_document">
            <xpath expr="//t/div[2]/div/h2" position="replace">
                <div>
<!--                    <div t-if="o.move_type=='in_invoice' and o.state!='cancel'">-->
<!--                        <h1 style="font-size: 2em; text-transform:uppercase">Fatura de Compra</h1>-->
<!--                    </div>-->
<!--                    <div t-if="o.move_type=='in_refund' and o.state!='cancel'">-->
<!--                        <h1 style="text-transform:uppercase">Nota de Crédito de Fornecedor</h1>-->
<!--                    </div>-->
<!--                    <div t-if="o.move_type=='in_invoice' and o.state=='cancel'">-->
<!--                        <h1 style="text-transform:uppercase">Fatura de Compra Cancelada</h1>-->
<!--                    </div>-->
<!--                    <div t-if="o.move_type=='in_refund' and o.state=='cancel'">-->
<!--                        <h1 style="text-transform:uppercase">Nota de Crédito de Fornecedor Cancelada</h1>-->
<!--                    </div>-->
<!--                    <div class="d-flex" style="float:left;font-size:22px;margin-top:9px">-->

<!--                    </div>-->
<!--                    <div t-if="o.partner_id.id" class="col-12">-->
<!--                        <h3 style="margin-bottom:0px;font-size:22px">-->
<!--                            <t>-->

<!--                                <t t-if="page_n==2">-->
<!--                                    <span style="float:right;font-size:11px;margin-top:9px">Duplicado-->
<!--                                        <span t-if="o.isprinted==True">&#160;(2ª Via)</span>-->
<!--                                    </span>-->
<!--                                </t>-->
<!--                                <t t-if="page_n==3">-->

<!--                                    <span style="float:right;font-size:11px;margin-top:9px">Triplicado-->
<!--                                        <span t-if="o.isprinted==True">&#160;(2ª Via)</span>-->
<!--                                    </span>-->
<!--                                    <div style="display:none">-->
<!--                                     <span t-esc="get_is_printed(o)"/>-->
<!--                                    </div>-->
<!--                                </t>-->
<!--                                <t t-if="page_n==4">-->
<!--                                    <span t-esc="get_is_printed(o)"/>-->
<!--                                    <span style="float:right;font-size:11px;margin-top:9px">Quadruplicado-->
<!--                                        <span t-if="o.isprinted==True">&#160;(2ª Via)</span>-->
<!--                                    </span>-->
<!--                                </t>-->
<!--                                <t t-if="page_n==5">-->
<!--                                    <span t-esc="get_is_printed(o)"/>-->
<!--                                    <span style="float:right;font-size:11px;margin-top:9px">Quintuplicado-->
<!--                                        <span t-if="o.isprinted==True">&#160;(2ª Via)</span>-->
<!--                                    </span>-->
<!--                                </t>-->
<!--                                <t t-if="page_n==6">-->
<!--                                    <span t-esc="get_is_printed(o)"/>-->
<!--                                    <span style="float:right;font-size:11px;margin-top:9px">Sextuplicado-->
<!--                                        <span t-if="o.isprinted==True">&#160;(2ª Via)</span>-->
<!--                                    </span>-->
<!--                                </t>-->
<!--                                <t t-if="page_n==7">-->
<!--                                    <span t-esc="get_is_printed(o)"/>-->
<!--                                    <span style="float:right;font-size:11px;margin-top:9px">Septuplicado-->
<!--                                        <span t-if="o.isprinted==True">&#160;(2ª Via)</span>-->
<!--                                    </span>-->
<!--                                </t>-->
<!--                                <t t-if="page_n==8">-->
<!--                                    <span t-esc="get_is_printed(o)"/>-->
<!--                                    <span style="float:right;font-size:11px;margin-top:9px">Octuplicado-->
<!--                                        <span t-if="o.isprinted==True">&#160;(2ª Via)</span>-->
<!--                                    </span>-->
<!--                                </t>-->
<!--                                <t t-if="page_n==9">-->
<!--                                    <span t-esc="get_is_printed(o)"/>-->
<!--                                    <span style="float:right;font-size:11px;margin-top:9px">Nonuplicado-->
<!--                                        <span t-if="o.isprinted==True">&#160;(2ª Via)</span>-->
<!--                                    </span>-->
<!--                                </t>-->
<!--                                <t t-if="page_n==10">-->
<!--                                    <span t-esc="get_is_printed(o)"/>-->
<!--                                    <span style="float:right;font-size:11px;margin-top:9px">Decuplicado-->
<!--                                        <span t-if="o.isprinted==True">&#160;(2ª Via)</span>-->
<!--                                    </span>-->
<!--                                </t>-->
<!--                            </t>-->
<!--                            <p><br/></p>-->
<!--                        </h3>-->
<!--                    </div>-->
                </div>
            </xpath>
            <xpath expr="//div[@name='address_not_same_as_shipping']/t/div[@id='partner_vat_address_not_same_as_shipping']/span[@t-field='o.partner_id.vat']" position="replace">
                <span t-field="o.commercial_partner_id.vat"/>
            </xpath>
            <xpath expr="//div[@name='address_same_as_shipping']/t/div[@id='partner_vat_address_same_as_shipping']/span[@t-field='o.partner_id.vat']" position="replace">
                <span t-field="o.commercial_partner_id.vat"/>
            </xpath>
            <xpath expr="//div[@name='no_shipping']/t/div[@id='partner_vat_no_shipping']/span[@t-field='o.partner_id.vat']" position="replace">
                <span t-field="o.commercial_partner_id.vat"/>
            </xpath>
            <xpath expr="//div[@id='informations']" position="replace">
                  <div id="informations" style="margin-top:35px;">
<!--                     <div t-if="o.invoice_date_due" name="invoice_expiry" style="float:right;">-->
<!--                        <span style="font-size:0.95em !important;">Date of Expiry:</span>-->
<!--                        <span t-field="o.invoice_date_due"/>-->
<!--                    </div>-->
                    <div t-if="o.date" name="invoice_date" style="float:right;">
                        <p><br/></p>
                        <span style="font-size:0.95em !important;">Date of Issue:</span>
                        <span t-field="o.date"/>
                    </div>
                    <div t-if="o.invoice_origin" name="origin" style="float:left;">
                                <p t-if="o.move_type == 'out_refund'" style="margin: 0; padding: 0;">
                                    <b t-if="o.credit"><span t-field="o.credit"/><br/></b>
                                    <span><b>Motivo:</b><span t-field="o.reason_cancel"/><br/></span>
                                    <t t-if="o.journal_id.saft_inv_type">
                                        <b>Origin:</b>
                                        <span t-esc="o.journal_id.saft_inv_type"/> <span t-field="o.invoice_origin"/>
                                    </t>
                                </p>
                    </div>
                 </div>
            </xpath>
            <xpath expr="//table[@class='table table-sm o_main_table table-borderless']/tbody"
               position="replace">
                <tbody class="invoice_tbody">
                    <t t-foreach="env['res.config.settings'].search([])" t-as="r">
                        <t t-set="pageline" t-value="r.line_per_page" />
                    </t>
                    <t t-set="current_subtotal" t-value="0"/>
                    <t t-set="current_total" t-value="0"/>
                    <t t-set="lines"
                       t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                    <t t-set="counter" t-value="1"/>
                    <t t-set="first_page" t-value="1"/>
                    <t t-set="line_extra" t-value="0"/>
                    <t t-set="sub_total" t-value="0"/>
                    <t t-set="pre_total" t-value="0"/>
                    <t t-foreach="lines" t-as="line">
                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal"/>
                        <t t-set="current_total" t-value="current_total + line.price_total"/>
                        <table class="table table-borderless" width="100%" style="margin:0;">
                            <tr style="line-height: 0.1; !important" t-att-class="'bg-200 fw-bold o_line_section' if line.display_type == 'line_section' else 'fst-italic o_line_note' if line.display_type == 'line_note' else ''">
                                <t t-if="line.display_type == 'product'" name="account_invoice_line_accountable">
                                    <td name="account_invoice_line_name">
                                        <span t-if="line.name" t-field="line.name" t-options="{'widget': 'text'}">Bacon
                                            Burger
                                        </span>
                                    </td>
                                    <td name="td_quantity" class="text-end">
                                        <span t-field="line.quantity">3.00</span>
                                        <span t-field="line.product_uom_id" groups="uom.group_uom">units</span>
                                    </td>
                                    <td name="td_price_unit"
                                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span class="text-nowrap" t-field="line.price_unit">9.00</span>
                                    </td>
                                    <td name="td_discount" t-if="display_discount"
                                        t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                        <span class="text-nowrap" t-field="line.discount">0</span>
                                    </td>
                                    <t t-set="taxes"
                                       t-value="', '.join([(tax.invoice_label or tax.name) for tax in line.tax_ids])"/>
                                    <td name="td_taxes"
                                        t-attf-class="text-start {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }} {{ 'text-nowrap' if len(taxes) &lt; 10 else '' }}">
                                        <span t-out="taxes" id="line_tax_ids">Tax 15%</span>
                                    </td>
                                    <td name="td_subtotal" class="text-end o_price_total">
                                        <span class="text-nowrap" t-field="line.price_subtotal">27.00</span>
                                    </td>
                                    <t t-set="sub_total" t-value="sub_total+line.price_subtotal"/>
                                    <t t-set="pre_total" t-value="pre_total+line.price_subtotal"/>
                                </t>
                                <t t-elif="line.display_type == 'line_section'">
                                    <td colspan="99">
                                        <span t-field="line.name" t-options="{'widget': 'text'}">A section title</span>
                                    </td>
                                    <t t-set="current_section" t-value="line"/>
                                    <t t-set="current_subtotal" t-value="0"/>
                                </t>
                                <t t-elif="line.display_type == 'line_note'">
                                    <td colspan="99">
                                        <span t-field="line.name" t-options="{'widget': 'text'}">A note, whose content
                                            usually applies to the section or product above.
                                        </span>
                                    </td>
                                </t>
                            </tr>
                        </table>
                        <t t-set="counter" t-value="counter+1"/>
                        <t t-if="first_page == 1">
                            <t t-if="pageline &lt; 15">
                                <t t-set="line_extra" t-value="pageline"/>
                            </t>
                            <t t-else="">
                                <t t-set="line_extra" t-value="15"/>
                            </t>
                        </t>
                        <t t-else="">
                            <t t-set="line_extra" t-value="pageline"/>
                        </t>

                        <t t-if="counter &gt; line_extra">
                            <div class="is-subtotal text-right col-3"
                                 style="border-top: 1px solid black; float:right; padding-right: 0px;">
                                <strong class="mr16" style="float:left;color:red;">Subtotal</strong>
                                <span class="text-nowrap" style="color:red;" t-esc="'{:,.2f}'.format(sub_total).replace(',', 'X').replace('.', ',').replace('X', '.')">9.00</span>
<!--                                <span t-esc="sub_total"-->
<!--                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'-->
<!--                                      style="float:right;color:red;"/>-->
                            </div>
                            <t t-set="first_page" t-value="0"/>
                            <p style="page-break-before:always;"/>
                            <div class="is-subtotal text-right">
                                <strong class="mr16" style="color:red;">Previous Subtotal</strong>
                                <span class="text-nowrap" style="color:red;" t-esc="'{:,.2f}'.format(pre_total).replace(',', 'X').replace('.', ',').replace('X', '.')">9.00</span>
<!--                                <span style="color:red;" t-esc="pre_total"-->
<!--                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>-->
<!--                                <t t-set="sub_total" t-value="0"/>-->
                            </div>
                            <br/>
                            <t t-set="counter" t-value="1"/>
                            <div  style="float:right;">
                                <span style="font-size:0.95em !important;">Date of Issue:</span>
                                <span t-field="o.date"/>
                            </div>
                            <table class="table table-sm o_main_table table-borderless" name="invoice_line_table" width="100%">
                                <thead style="border-bottom: 3px solid black;border-top: 13px solid #56739a;">
                                    <tr>
                                        <th name="th_code" class="text-start" width="15%">Product Code</th>
                                        <th name="th_description" class="text-start" width="25%">Description</th>
                                        <th name="th_quantity" class="text-end" width="10%">Quantity</th>
                                        <th name="th_priceunit" width="10%"
                                          t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                          <span>UnitPrice</span>
                                        </th>
                                         <th name="th_discount" width="10%"
                                             t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                                            <span>Disc%</span>
                                         </th>
                                       <th name="th_taxes" width="10%" style="text-align:right;">
                                        <span>Tax%</span>
                                       </th>
                                        <th name="th_exemption_code" width="10%" style="text-align:right;">Exemption Code <span style="color:red;">*</span></th>
                                        <th name="th_subtotal" width="10%" class="text-end">
                                            <span>Total</span>
                                        </th>
                                    </tr>
                                </thead>
                            </table>
                        </t>
                    </t>
                </tbody>
            </xpath>

            <xpath expr="//table[@class='table table-sm o_main_table table-borderless']/thead" position="attributes">
                <attribute name="style">border-bottom: 3px solid black;border-top: 13px solid #56739a;</attribute>
            </xpath>
             <xpath expr="//table[@class='table table-sm o_main_table table-borderless']" position="attributes">
                <attribute name="width">100%</attribute>
            </xpath>
            <xpath expr="//div[@t-field='o.partner_shipping_id']" position="after">
                <div class="mt16" groups="sale.group_delivery_invoice_address">
                    <t t-if="o.loading_date">
                        <strong>Data de Carga:</strong>
                        <span t-field="o.loading_date"/>
                        <t t-if="o.loading_date and not o.unloading_date">
                            <br/>
                        </t>
                    </t>
                    <t t-if="o.loading_date and o.unloading_date">/</t>
                    <t t-if="o.unloading_date">
                        <strong>Data de Descarga:</strong>
                        <span t-field="o.unloading_date"/>
                        <br/>
                    </t>
                    <t t-if="o.vehicle_registration">
                        <strong>Matrícula:</strong>
                        <span t-field="o.vehicle_registration"/>
                        <br/>
                    </t>
                    <br/>
                </div>
            </xpath>
            <xpath expr="//div[@t-if='o.partner_id.vat']" position="replace">
            </xpath>

            <xpath expr="//div[@id='right-elements']" position="attributes">
               <attribute name="t-attf-class">#{'col-12' if report_type != 'html' else 'col-12 col-md-12'} ms-12 d-inline-block float-end</attribute>
            </xpath>

            <xpath expr="//div[@id='total']" position="replace">
                <div id="total" class="row">
                    <t t-call="cit_reports_extended.document_tax_totals_opencloud"/>
                </div>
            </xpath>
            <xpath expr="//div[@id='total']" position="before">
                <p style="margin-top:300px;color:black;margin-bottom:0px;font-size:14px;">
                    <span style="font-weight:bold;margin-right:10px;">Resumo do Imposto</span>
                    <span><t t-call="cit_reports_extended.at_processado_por"/></span>
                </p>
            </xpath>
            <xpath expr="//table[@class='table table-sm o_main_table table-borderless']/thead/tr/th[@name='th_description']"
                   position="before">
                    <th name="th_code" class="text-start" width="15%" >Product Code</th>
            </xpath>
            <xpath expr="//table[@class='table table-sm o_main_table table-borderless']/thead/tr/th[@name='th_description']"
                   position="replace">
                    <th name="th_description" class="text-start" width="25%">Description</th>
            </xpath>
            <xpath expr="//table[@class='table table-sm o_main_table table-borderless']/thead/tr/th[@name='th_quantity']"
                   position="replace">
                    <th name="th_quantity" class="text-end" width="10%" style="text-align:right;">Quantity</th>
            </xpath>
             <xpath expr="//table[@class='table table-sm o_main_table table-borderless']/thead/tr/th[@name='th_taxes']"
                    position="after">
                    <th name="th_exemption_code" style="text-align:right;" width="10%">Exemption Code <span style="color:red;">*</span></th>
            </xpath>
            <xpath expr="//table[@class='table table-sm o_main_table table-borderless']/thead/tr/th[@name='th_discount']"
                   position="replace">
                     <th name="th_discount"
                         t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}" width="10%" style="text-align:right;">
                                        <span>Disc%</span>
                     </th>
            </xpath>
            <xpath expr="//table[@class='table table-sm o_main_table table-borderless']/thead/tr/th[@name='th_taxes']"
                   position="replace">
                <th width="10%" style="text-align:right;" name="th_taxes">
                    <span>Tax%</span></th>
            </xpath>
            <xpath expr="//table[@class='table table-sm o_main_table table-borderless']/thead/tr/th[@name='th_subtotal']"
                   position="replace">
                    <th width="10%" name="th_subtotal" class="text-end" style="text-align:right;">
                        <span>Total</span>
                    </th>
            </xpath>
              <xpath expr="//table[@class='table table-sm o_main_table table-borderless']/thead/tr/th[@name='th_priceunit']"
                   position="replace">
                  <th  width="10%" name="th_priceunit" style="text-align:right;"
                      t-attf-class="text-end {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                      <span>UnitPrice</span></th>
            </xpath>
             <td name="td_price_unit" position="replace">
                 <td width="10%" style="text-align:right;" name="td_price_unit">
                     <span class="text-nowrap" t-esc="'{:,.2f}'.format(line.price_unit).replace(',', 'X').replace('.', ',').replace('X', '.')">9.00</span>
                 </td>
             </td>
            <td name="td_discount" position="replace">
                <td width="10%" name="td_discount" style="text-align:right;">
                    <span class="text-nowrap" t-esc="'{:,.2f}'.format(line.discount).replace(',', 'X').replace('.', ',').replace('X', '.')">0.00</span>
                </td>
            </td>
             <xpath expr="//td[@name='account_invoice_line_name']" position="before">
                        <td width="15%" name="product_code"><span t-if="line.product_id.default_code"
                                                      t-field="line.product_id.default_code"/></td>
            </xpath>
            <xpath expr="//td[@name='account_invoice_line_name']" position="replace">
                    <td style="white-space: nowrap;overflow: hidden;max-width: 200px;" width="25%" name="account_invoice_line_name"><span t-if="line.product_id.product_tmpl_id.name"
                        t-field="line.product_id.product_tmpl_id.name" t-options="{'widget': 'text'}"/>
                    </td>
            </xpath>
            <xpath expr="//td[@name='td_taxes']" position="replace">
                        <td style="text-align:right;" width="10%" name="td_taxes">
                            <t t-set="taxes" t-value="', '.join(['{:.1f}'.format(round(tax.amount, 1)).rstrip('0').rstrip('.') for tax in line.tax_ids])"/>
                            <span t-out="taxes" id="line_tax_ids">Tax 15%</span>
                        </td>
            </xpath>
            <xpath expr="//td[@name='td_taxes']" position="after">
                        <td width="10%" name="td_exemption_code" style="text-align:right;">
                            <t t-if="line.tax_ids.exemption_reason.code">
                                <span t-out="line.tax_ids.exemption_reason.code" id="exemption_code"/>
                            </t>
                            <t t-else="">
                                <span> </span>
                            </t>
                        </td>
            </xpath>
            <xpath width="10%" expr="//td[@name='td_quantity']" position="replace">
                        <td name="td_quantity" style="text-align:right;" class="text-end" width="10%">
                            <span class="text-nowrap" t-field="line.quantity"/>
                        </td>
            </xpath>
            <xpath width="10%" expr="//td[@name='td_subtotal']" position="replace">
                        <td name="td_subtotal" style="text-align:right;" class="text-end o_price_total" width="10%">
                            <span class="text-nowrap" t-esc="'{:,.2f}'.format(line.price_subtotal).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                        </td>
            </xpath>
            <xpath expr="//div[@id='total']" position="after">
                <br/>
<!--                <p style="color:red;font-weight:bold;"> <span style="margin-right:50px;"> Retenção </span><span>0,00</span></p>-->
            </xpath>


            <xpath expr="//div[@name='comment']" position="after">
                    <div t-if="'ref_multibanco' in o and o.ref_multibanco" class="text-muted mb-3">
                        <div style="text-align: justify;">
                            <p>
                                <b>Dados para pagamento por multibanco:</b>
                            </p>
                            <div style="width:20%; display:inline-table;">
                                <img class="oe_edi_paypal_button"
                                     src="http://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Multibanco.svg/241px-Multibanco.svg.png"
                                     height="75px" width="75px"/>
                            </div>
                            <div align="left" style="width:70%; display:inline-table;">
                                <div align="left" style="display-block:inline;">
                                    Entidade:
                                    <strong>
                                        <span t-field="o.journal_id.entidade"/>
                                    </strong>
                                    <br/>
                                    Referência:
                                    <strong>
                                        <span t-field="o.ref_multibanco"/>
                                    </strong>
                                    <br/>
                                    Montante:
                                    <strong>
                                        <span t-field="o.amount_total"/>
                                        <span t-field="o.currency_id.name"/>
                                    </strong>
                                    <br/>
                                </div>
                            </div>
                        </div>
                    <div t-if="o.company_id.bank_journal_ids" class="text-muted mb-3">
                        <div style="text-align: justify;">
                            <p style="display:inline">
                                <t t-set="hash_banks" t-value="False"/>
                                <t t-foreach="o.company_id.bank_journal_ids" t-as="journal">
                                    <t t-if="journal.bank_account_id.acc_number">
                                        <t t-set="hash_banks" t-value="True"/>
                                    </t>
                                </t>
                                <span t-if="hash_banks"><b>Dados Bancários:</b>
                                    <t t-foreach="o.company_id.bank_journal_ids" t-as="journal">
                                        <t t-set="bank_acc" t-value="journal.bank_account_id"/>
                                        <t t-if="journal.bank_account_id">
                                            <li>
                                                <span t-esc="bank_acc.bank_name"/>
                                                <t t-if="bank_acc.bank_bic">(<span t-esc="bank_acc.bank_bic"/>)
                                                </t>
                                                <t t-if="bank_acc.bank_name and bank_acc.acc_number">:</t>
                                                <span t-esc="bank_acc.acc_number"/>
                                            </li>
                                            <t t-set="is_first" t-value="False"/>
                                        </t>
                                    </t>
                                </span>
                            </p>
                        </div>
                    </div>
                </div>

                    <div class="text-muted mb-3">
                        <p t-if="o.journal_id.saft_inv_type=='NC'">
                            Ao abrigo do nº5 do artigo 78 do CIVA, agradecemos a devolução do duplicado desta Nota
                            de Crédito, devidamente assinada e carimbada.
                        </p>
                        <p t-if="o.state=='cancel' or o.move_type in ('in_refund', 'out_refund')">
                            <b>Motivo de Anulação:</b>
                            <span t-field="o.reason_cancel"/>
                        </p>
                        <p t-if="o.move_type in ('in_refund', 'out_refund')">
                            <b>Assinatura do Cliente: </b>
                            ____________________________________
                        </p>
                        <p t-if="o.journal_id.manual==True">
                            Cópia do Documento Original - <span t-field="o.invoice_origin"/>
                        </p>
                        <p t-if="o.state=='draft'">
                            Este Documento não serve como Fatura.
                            <p>Nota Informativa
                                <span t-field="o.company_id.name"/>
                            </p>
                        </p>
                    </div>
            </xpath>
        </template>

        <template id="invoice_footer_notes">
<!--            <t t-if="o and o._name=='account.move'">-->
<!--                <div style="font-size: 13px;">-->
<!--                    <span t-field="o.company_id.invoice_footer_notes"/>-->
<!--                </div>-->
<!--            </t>-->
        </template>

        <template id="at_processado_por">
            <t t-if="o and (o._name=='sale.order' or
                     o._name=='account.move' or
                     o._name=='stock.picking' or
                     o._name=='account.payment')">
                <t t-if="o.hash">
                              <span style="font-weight:bold;" t-esc="str(o.hash[0:1]) + str(o.hash[10:11]) + str(o.hash[20:21]) + str(o.hash[30:31])"/>
                              - Processado por programa validado nº 01180000/AGT/2024 Odoo.
                </t>
            </t>
        </template>

        <template id="at_at_code">
            <t t-if="o and (o._name=='sale.order' or
                     o._name=='account.move' or
                     o._name=='stock.picking' or
                     o._name=='account.payment')">
                <div id="qrcode_at" >
                    <span style="font-size: 12px" t-if="o.atcud and o.hash" class="text-center">
                        ATCUD:<span t-field="o.atcud"/>
                    <br/>
                    </span>
                    <t t-if="o.hash and o.qr_code_at_img">
                        <img t-attf-src="data:image/*;base64,{{o.qr_code_at_img}}"/>
                    </t>
                </div>
            </t>
        </template>

        <template id="document_tax_totals_opencloud">
              <!--
                Generic template to display tax totals in pdf reports.
                Used by invoices, SO and PO.

                ARGUMENTS:
                - tax_totals: dict in the form generated by account.move's _get_tax_totals.
            -->
            <div class="col-8" style="border-top: 4px solid black;">
              <table class="table table-borderless">
              <tr>
                  <td class="text-start" style="font-weight:bold;"><strong>Description</strong></td>
                  <td class="text-start" style="font-weight:bold;"><strong>Tax%</strong></td>
                  <td class="text-start" style="font-weight:bold;"><strong>Base</strong></td>
                  <td class="text-start" style="font-weight:bold;"><strong>Valor Imposto</strong></td>
                  <td class="text-start" style="font-weight:bold;"><strong>Exemption Reason</strong></td>
              </tr>
                  <t t-set="calculated_tax" t-value="0"/>
              <tr t-foreach="o.amount_by_group" t-as="amount_by_group" class="o_total">
                   <td>
                       <span t-esc="amount_by_group[6] == 'ISE' and 'Isento' or amount_by_group[8]" />
                  </td>
                  <td>
                      <span t-esc="'{:.1f}'.format(amount_by_group[9]).rstrip('0').rstrip('.')"/>
                  </td>
                  <td class="text-right">
                      <span t-esc="'{:,.2f}'.format(amount_by_group[2]).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                  </td>
                  <td class="text-right">
                    <t t-set="formatted_amount" t-value="'{:.1f}'.format(amount_by_group[9]).rstrip('0').rstrip('.')"/>
                    <t t-set="amount_value" t-value="float(formatted_amount)"/>
                    <t t-set="calculated_amount" t-value="(amount_value / 100) * amount_by_group[2]"/>
                    <span t-esc="'{:,.2f}'.format(calculated_amount).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                  </td>
                  <td class="text-right">
                      <t t-if="amount_by_group[7]">
                        <span t-esc="amount_by_group[7].name"/>
                      </t>
                  </td>
              </tr>
            </table>
           </div>
            <!--<div class="col-1"/>        -->
             <div class="col-4 " style="border-top: 4px solid black;">
                  <table class="table table-borderless">
                      <tr>
                          <td>
                              <strong>Total Ilíquido</strong>
                          </td>
                          <td class="text-right text-end">
				<t t-set="disc_totals" t-value="sum((line.discount / 100.0) * (line.price_unit * line.quantity) for line in lines) if lines else 0.0"/>
				<t t-set="amount_untaxed" t-value="o.amount_untaxed if o.amount_untaxed is not None else 0.0"/>
				<t t-set="total_with_discount" t-value="amount_untaxed + disc_totals"/>
				<span t-esc="'{:,.2f}'.format(total_with_discount).replace(',', 'X').replace('.', ',').replace('X', '.')" />
			</td>

                      </tr>
                      <tr>
                          <td>
                              <strong>Total Desconto</strong>
                          </td>
                          <td class="text-right text-end">
                            <t t-set="disc_total" t-value="sum((line.discount / 100.0) * (line.price_unit * line.quantity) for line in lines)"/>
                            <span t-esc="'{:,.2f}'.format(disc_total).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                          </td>
                      </tr>
                      <tr>
                            <td style="font-weight:bold;">Total Imposto</td>
                            <td class="text-right text-end">
                                <span t-esc="'{:,.2f}'.format(o.amount_tax).replace(',', 'X').replace('.', ',').replace('X', '.')"/>
                            </td>
                        </tr>
                      <tr class="border-black o_total">
                          <td>
                              <strong t-if="o.journal_id.saft_inv_type != 'FR' and o.payment_state == 'not_paid' or o.move_type in ('in_refund', 'out_refund')">Total á pagar</strong>
			      <strong t-if="o.journal_id.saft_inv_type == 'FR' or o.payment_state != 'not_paid' and o.move_type not in ('in_refund', 'out_refund')">Total Pago</strong>
                          </td>
                          <td class="text-right text-end">
                              <span t-esc="'{:,.2f}'.format(o.amount_total).replace(',', 'X').replace('.', ',').replace('X', '.')" />
                          </td>
                      </tr>
                  </table>
            </div>
        </template>

        <template id="payments_group">
            <!--Payments-->
            <div class="col-8"/>
            <div class="col-4">
                <t t-if="print_with_payments">
                    <t t-if="o.payment_state != 'invoicing_legacy'">
                        <t t-set="payments_vals" t-value="o.sudo().invoice_payments_widget and o.sudo().invoice_payments_widget['content'] or []"/>
                        <table class="table table-borderless">
                            <t t-foreach="payments_vals" t-as="payment_vals">
                                <tr t-if="payment_vals['is_exchange'] == 0">
                                    <td>
                                        <i class="oe_form_field text-end oe_payment_label">Paid on <t t-esc="payment_vals['date']" t-options='{"widget": "date"}'/></i>
                                    </td>
                                    <td class="text-end">
                                        <span t-esc="payment_vals['amount']" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                    </td>
                                </tr>
                            </t>
                            <t t-if="len(payments_vals) > 0">
                                <tr class="border-black o_total">
                                    <td><strong>Amount Due</strong></td>
                                    <td class="text-end">
                                        <span t-field="o.amount_residual"/>
                                    </td>
                                </tr>
                                </t>
                        </table>
                    </t>
                </t>
            </div>
        </template>

        <template id="account.report_invoice">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-set="lang"
                       t-value="o.user_id.lang if o.move_type in ('in_invoice', 'in_refund') else o.partner_id.lang"/>
                    <t t-set="n_copies" t-value="int(o.company_id.n_copies_invoice)"/>
                    <t t-foreach="range(n_copies)" t-as="n_pages">
                        <t t-set="page_n" t-value="n_pages+1"/>
                        <t t-if="page_n==1">
                            <t t-call="account.report_invoice_document" t-lang="'pt_PT'"/>
                        </t>
                        <t t-else="">
                            <t t-call="account.report_invoice_document" t-lang="lang"/>
                        </t>
                    </t>
                </t>
            </t>
        </template>

        <template id="account.report_invoice_with_payments">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-set="lang" t-value="o.invoice_user_id.sudo().lang if o.move_type in ('in_invoice', 'in_refund') else o.partner_id.lang"/>
                    <t t-set="print_with_payments" t-value="True"/>
                    <t t-set="n_copies" t-value="int(o.company_id.n_copies_invoice)"/>
                    <t t-foreach="range(n_copies)" t-as="n_pages">
                        <t t-set="page_n" t-value="n_pages+1"/>
                        <t t-if="page_n==1">
                            <t t-if="o._get_name_invoice_report() == 'account.report_invoice_document'"
                        t-call="account.report_invoice_document" t-lang="'pt_PT'"/>
                        </t>
                        <t t-else="">
                            <t t-if="o._get_name_invoice_report() == 'account.report_invoice_document'"
                        t-call="account.report_invoice_document" t-lang="lang"/>
                        </t>
                    </t>
                </t>
            </t>
        </template>

</odoo>
